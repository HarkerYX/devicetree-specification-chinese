# 5. 扁平化的设备树格式
DTB(Devicetree Blob)格式是设备树书的平面二进制编码。它用于在软件程序之间的设备树数据交换。比如说，在启动操作系统的时候，固件会将DTB传递给内核中。   
&nbsp;
```
注意：
开放固件[IEEE1275]并没有定义DTB格式。在大多数开放固件兼容平台上设备树被解析的方式是通过调用固件遍历设备树结构体的方法。
```  
<br/>
DTB格式将设备树中数据通过单一、线性以及无指针的方式编码成一个数据结构。它包含了一个small header(详见5.2节)，紧随其后的是三个大小可变的部分，其分别是内存预留块(详见5.3节)，结构体块(详见5.4节)和字符串块(详见5.5节)。这些都将会被有序的展示于设备树中。因此，设备树结构体是一个整体，当它所在的地址被加载到内存中时，就会像图5.1(结构体头部将位于低地址)。  
![数据结构](../images/Fig.5.1_Devicetree.dtb_structure.png)
<p align="center"><b>Fig.5.1 Devicetree .dtb 数据结构</b></p>
  
<br/>
图中的free space可能不存在，但是在某些情况下可能需要满足单个块的对齐约束(详见5.6节)。 

<br/>  

## 5.1 版本控制
距离最初的格式定义以来，已经定义了几个版本的devicetreee结构体。标头中的字段提供版本，以便确定自己的程序是否可以兼容格式编码。  
本文档描述的第17版。符合DTSpec的引导程序应该提供17th版或者更高版本的devicetree，符合DTSpec的程序应该接受与17th版向后兼容的任何版本的devicetree，当然也可以接受其他版本。
