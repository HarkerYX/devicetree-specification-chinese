<p align = "center"><b>项目主页:https://github.com/Sunrisepeak/devicetree-specification-chinese</b></p>

---

[<目录](../README.md)

## 3 设备节点规范

### 3.1 基础设备节点类型

这章节将会描述遵循设备树规格书要求的设备节点的基础集合。

所有设备树必须要有根节点，并且所有设备书应该要有如下的根节点。

- 一个 `/cpus` 节点
- 至少一个 `/memory`节点

### 3.2 根节点 `root`

设备书有一个唯一的根节点`/`，所有其他的设备节点都为其子节点（后代）

<p align = "center"><b>表3.1 根节点属性</b></p>

|      属性名      | 用法 |     值类型     |                             定义                             |
| :--------------: | :--: | :------------: | :----------------------------------------------------------: |
| `#address-cells` |  R   |    `<u32>`     |   指定`/`的子节点中`reg`属性中表示地址所需的`<u32>`的数量    |
|  `#size-cells`   |  R   |    `<u32>`     |   指定`/`的子节点中`reg`属性中表示大小所需的`<u32>`的数量    |
|     `model`      |  R   |   `<string>`   |   指定能唯一标识主板的字符串，推荐的格式是`"制造商,型号"`    |
|   `ompatible`    |  R   | `<stringlist>` | 指定与这个平台相兼容的体系结构列表。操作系统可以使用此属性选择特定的平台代号。 |
|                  |      |                | 属性值的推荐格式是`"制造商,型号"`，例如: `compatible = "fsl, mpc8572ds"` |

> **备注**：
>
> - R 为要求的，O为可选的，OR为可选但推荐的，SD为根据定义。
> - 所有其他标准属性为可选项



### 3.3 `/aliases` 节点

一个设备树可能有定义一个或多个别名属性的别名节点(`/aliases`)。别名节点必须在设备树的根节点并用`/aliases`命名。

`/aliases`节点的每个属性都定义一个别名。属性名表示这个别名，属性值表示一个节点在设备树中的属性。例如，属性`serial0="/simple-bus@fe000000/serial@11c500"`定义了别名`serial0`.

别名必须是下面表3.2中的字符集所组成的小写且长度为1～31的字符串。

<p align = "center"><b>表3.2 别名的有效字符</b></p>

| 字符 |   描述   |
| :--: | :------: |
| 0-9  |   数字   |
| a-z  | 小写字母 |
|  -   |  破折号  |



别名的值是一个设备的路径。这个值描述了节点的完整路径，而该路径不需要引用叶节点。

一个客户端程序可能要使用一个属性别名去引用完整的设备路径或其字符串值的一部分。当考虑字符串作为设备路径时，客服端程序应该检测并使用别名。

**例子**

```dtd
aliases {
    serial0 = "/simple-bus@fe000000/serial@llc500";
    ethernet0 = "/simple-bus@fe000000/ethernet@31c000";
};
```

对于别名`serial0`,客户端程序能查询`/aliases`节点并且确定别名引用的设备路径`/simple-bus@fe000000/serial@11c500`.



#### 3.4 `/memory`节点

所有设备树都需要内存设备节点来描述系统的物理内存层。如果系统有多个内存区域/块，可以创建多个内存节点或在`rep`属性中指定内存范围。

节点名的`unit-name`必须是memory（见2.2.1节）。

客户端程序可以使用它选择的任何存储属性访问任何非保留内存区域。然而，在改变用于访问实际页改变的存储属性之前，客户端程序需要执行架构所要求的一些操作，可能包括刷新cache缓存中的内容到真实的页。引导程序负责保证，`WIMG=0b001x`时，客户端程序可以安全的访问所有内存，而不会受存储属性变化的影响。例如：

- 不需要直写
- 非禁止缓存
- 内存一致性
- 防护要求

如果支持VLE存储属性，则`VLE=0`。

<p align = "center"><b>表3.3 /memory节点属性</b></p>

|        属性名         | 用法 |         值类型         |                             定义                             |
| :-------------------: | :--: | :--------------------: | :----------------------------------------------------------: |
|     `device_type`     |  R   |       `<string>`       |                       值必须是"memory"                       |
|         `reg`         |  R   | `<prop-encoded-array>` | 任意数值组成的地址和大小对（类似键值对）来描述物理地址和内存区域的大小 |
| `initial-mapped-area` |  O   | `<prop-encoded-array>` | 描述最初映射区域的地址和大小。是由`(有效地址，物理地址，大小)`形式的三元组所组成的数组。其中有效/物理地址应该是用64位描述，大小用32位值描述 |

> 注：所有其他标准属性为可选项。（见2.3节）

**例子**



